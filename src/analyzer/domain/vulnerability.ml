open Graphjs_base
open Graphjs_share
open Graphjs_mdg

type t =
  { kind : string
  ; sink : string
  ; line : int
  }

let create (kind : string) (sink : string) (line : int) : t =
  { kind; sink; line }

let make (sink : Tainted.sink) (node : Node.t) : t =
  let name = Tainted.(name !sink) in
  let kind = Sink_kind.str (Tainted.kind sink) in
  create kind name node.at.lpos.line

let update (vuln : t) (node : Node.t) : t =
  { vuln with line = node.at.lpos.line }

let pp (ppf : Fmt.t) (vuln : t) : unit =
  Fmt.fmt ppf "{@\n@[<v 2>  ";
  Fmt.fmt ppf "\"vuln_type\": %S" vuln.kind;
  Fmt.fmt ppf "@\n\"sink\": %S" vuln.sink;
  Fmt.fmt ppf "@\n\"sink_lineno\": %d@]" vuln.line;
  Fmt.fmt ppf "@\n}"

let str (vuln : t) : string = Fmt.str "%a" pp vuln [@@inline]
